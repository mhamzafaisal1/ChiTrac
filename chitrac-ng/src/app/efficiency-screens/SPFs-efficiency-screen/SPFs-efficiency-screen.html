<div class="screen-container">
  <div class="lanes-wrapper" *ngIf="!isLoading && lanes.length > 0">
    <div class="lane-container" *ngFor="let lane of lanes; trackBy: ident">
      <!-- Running state (status === 1) -->
      <ng-container *ngIf="lane.status === 1">
        <div class="lane-background" [ngClass]="lane.operator ? 'lane-running-bg' : 'lane-greyed-bg'">
          <div class="lane-inner">
            <div class="operator-block" [ngClass]="{'no-operator': !lane.operator, 'red': lane.efficiency.lastSixMinutes.color == 'red', 'green': lane.efficiency.lastSixMinutes.color == 'green', 'yellow': lane.efficiency.lastSixMinutes.color == 'yellow'}">
              <div class="operator-text">
                <div class="operator-content">{{ lane.operator || 'NO OPERATOR' }}</div>
              </div>
            </div>
            <div class="data-block">
              <div class="efficiency-value" [ngClass]="{'red': lane.efficiency.lastSixMinutes.color == 'red', 'green': lane.efficiency.lastSixMinutes.color == 'green', 'yellow': lane.efficiency.lastSixMinutes.color == 'yellow'}">
                <div class="value-text">{{ (lane.efficiency?.lastSixMinutes?.value || 0) | number: '1.0-0' }}%</div>
              </div>
              <div class="bars-container">
                <div class="bars">
                  <div class="bar-item" style="margin: 10px 5px 0 0;">
                    <div class="bar-chart">
                      <div class="bar-value">{{ (lane.efficiency?.lastFifteenMinutes?.value || 0) | number: '1.0-0' }}%</div>
                      <div class="bar-fill" [style.height.%]="lane.efficiency?.lastFifteenMinutes?.value || 0"  [ngClass]="{'red': lane.efficiency.lastFifteenMinutes.color == 'red', 'green': lane.efficiency.lastFifteenMinutes.color == 'green', 'yellow': lane.efficiency.lastFifteenMinutes.color == 'yellow'}"></div>
                    </div>
                    <div class="bar-label">{{ lane.efficiency?.lastFifteenMinutes?.label }}</div>
                  </div>
                  <div class="bar-item" style="margin: 10px 2px 0 2px;">
                    <div class="bar-chart">
                      <div class="bar-value">{{ (lane.efficiency?.lastHour?.value || 0) | number: '1.0-0' }}%</div>
                      <div class="bar-fill" [style.height.%]="lane.efficiency?.lastHour?.value || 0" [ngClass]="{'red': lane.efficiency.lastHour.color == 'red', 'green': lane.efficiency.lastHour.color == 'green', 'yellow': lane.efficiency.lastHour.color == 'yellow'}"></div>
                    </div>
                    <div class="bar-label">{{ lane.efficiency?.lastHour?.label }}</div>
                  </div>
                  <div class="bar-item" style="margin: 10px 0 0 5px;">
                    <div class="bar-chart">
                      <div class="bar-value">{{ (lane.efficiency?.today?.value || 0) | number: '1.0-0' }}%</div>
                      <div class="bar-fill" [style.height.%]="lane.efficiency?.today?.value || 0" [ngClass]="{'red': lane.efficiency.today.color == 'red', 'green': lane.efficiency.today.color == 'green', 'yellow': lane.efficiency.today.color == 'yellow'}"></div>
                    </div>
                    <div class="bar-label">{{ lane.efficiency?.today?.label }}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="item-block" [ngClass]="{'item-block-greyed': !lane.operator}">
          <div class="item-line">{{ lane.machine }}</div>
          <div class="item-line">{{ lane.batch?.item }}</div>
          <div class="item-line">{{ lane.batch?.code }}</div>
        </div>
      </ng-container>

      <!-- Stopped state (status === 0 or status === -1) -->
      <ng-container *ngIf="lane.status === 0 || lane.status === -1">
        <div class="lane-background lane-stop-bg">
          <div class="lane-inner">
            <div class="operator-block stopped">
              <div class="operator-text">
                <div class="operator-content">{{ lane.operator || 'NO OPERATOR' }}</div>
              </div>
            </div>
            <div class="data-block stopped">
              <div class="fault-display">
                <div style="height: 40%;"></div>
                <div class="fault-text">{{ lane.fault }}</div>
              </div>
              <div class="timer-display">
                <div class="timer-text">ELAPSED TIME: {{ lane.displayTimers?.on }}</div>
              </div>
            </div>
          </div>
        </div>
        <div class="item-block item-block-stopped">
          <div class="item-line">{{ lane.machine }}</div>
          <div class="item-line">{{ lane.batch?.item }}</div>
          <div class="item-line">{{ lane.batch?.code }}</div>
        </div>
      </ng-container>

      <!-- Fault state (status > 1) -->
      <ng-container *ngIf="lane.status > 1 && lane.status !== -1">
        <div class="lane-background lane-fault-bg">
          <div class="lane-inner">
            <div class="operator-block fault">
              <div class="operator-text">
                <div class="operator-content">{{ lane.operator || 'NO OPERATOR' }}</div>
              </div>
            </div>
            <div class="data-block fault">
              <div class="fault-display">
                <div style="height: 40%;"></div>
                <div class="fault-text">{{ lane.fault }}</div>
                <div class="fault-label">FAULT</div>
                <div class="fault-code">CODE: {{ lane.status }}</div>
              </div>
              <div class="timer-display">
                <div class="timer-text">ELAPSED TIME: {{ lane.displayTimers?.on }}</div>
              </div>
            </div>
          </div>
        </div>
        <div class="item-block item-block-fault">
          <div class="item-line">{{ lane.machine }}</div>
          <div class="item-line">{{ lane.batch?.item }}</div>
          <div class="item-line">{{ lane.batch?.code }}</div>
        </div>
      </ng-container>
      <app-efficiency-screen-lane [lane]="lane" [mode]="getLaneMode(lane)"></app-efficiency-screen-lane>
    </div>
  </div>

  <!-- Loading state -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-text">Loading SPF machines...</div>
  </div>

  <!-- No data state -->
  <div class="no-data-container" *ngIf="!isLoading && lanes.length === 0">
    <div class="no-data-text">No SPF machines found</div>
  </div>
</div>

